<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾æ¥­å…¥å£å¹³å° | æ‚¨çš„ç¾æ„Ÿç”Ÿæ´»åœ°åœ–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50 pb-20">

    <div id="page-home" class="page active">
        <header class="bg-white p-4 sticky top-0 z-50 shadow-sm">
            <div class="flex justify-between mb-3">
                <div class="flex items-center text-rose-500 cursor-pointer" onclick="toggleMap()">
                    <i data-lucide="map" class="w-5 h-5 mr-1"></i>
                    <span class="font-bold text-sm">é»æ“Šé–‹å•Ÿåœ°åœ–æœå°‹</span>
                </div>
                <div id="user-top-info" class="text-xs text-gray-500 font-bold">ç¾æ¥­å…¥å£å¹³å°</div>
            </div>
            <div class="relative">
                <input type="text" placeholder="æœå°‹ï¼šç¾é«®ã€ç¾ç”²ã€SPAã€é†«ç¾..." class="w-full bg-gray-100 rounded-full py-2 px-10 focus:outline-none focus:ring-2 focus:ring-rose-300">
                <i data-lucide="search" class="absolute left-3 top-2.5 w-5 h-5 text-gray-400"></i>
            </div>
        </header>

        <section class="p-4 flex gap-6 overflow-x-auto no-scrollbar bg-white shadow-inner">
            <div class="flex flex-col items-center min-w-[60px]" onclick="filterCategory('Hair')">
                <div class="w-12 h-12 bg-rose-100 rounded-2xl flex items-center justify-center text-rose-500 mb-1"><i data-lucide="scissors"></i></div>
                <span class="text-xs font-medium">ç¾é«®</span>
            </div>
            <div class="flex flex-col items-center min-w-[60px]" onclick="filterCategory('Nail')">
                <div class="w-12 h-12 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-500 mb-1"><i data-lucide="sparkles"></i></div>
                <span class="text-xs font-medium">ç¾ç”²</span>
            </div>
            <div class="flex flex-col items-center min-w-[60px]" onclick="filterCategory('SPA')">
                <div class="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-500 mb-1"><i data-lucide="waves"></i></div>
                <span class="text-xs font-medium">SPA</span>
            </div>
            <div class="flex flex-col items-center min-w-[60px]" onclick="filterCategory('Clinic')">
                <div class="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center text-green-500 mb-1"><i data-lucide="heart-pulse"></i></div>
                <span class="text-xs font-medium">é†«ç¾</span>
            </div>
        </section>

        <main class="p-4 space-y-4">
            <h2 class="font-bold text-lg text-gray-800">é™„è¿‘ç¾æ¥­æ¨è–¦</h2>
            <div id="shop-list" class="space-y-4">
                </div>
        </main>
    </div>

    <div id="page-detail" class="page">
        <nav class="p-4 bg-white flex items-center border-b sticky top-0 z-50">
            <button onclick="navigateTo('page-home')"><i data-lucide="arrow-left" class="w-6 h-6"></i></button>
            <h2 id="current-shop-name" class="ml-4 font-bold text-lg">åº—å®¶è©³æƒ…</h2>
        </nav>
        <div class="p-4 space-y-6">
            <div class="bg-rose-50 p-4 rounded-xl border border-rose-100 text-rose-700 text-sm">
                ğŸ’¡ æœ¬åº—æ”¯æ´<b>å„²å€¼é‡‘æ”¯ä»˜</b>ï¼Œé ç´„æ›´å¿«é€Ÿã€‚
            </div>
            <div id="service-menu" class="space-y-3">
                </div>
            <button onclick="submitBooking()" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold shadow-lg">ç¢ºèªé ç´„</button>
        </div>
    </div>

    <div id="page-orders" class="page">
        <header class="bg-white p-4 sticky top-0 z-50 border-b">
            <h2 class="font-bold text-lg">æˆ‘çš„è¡Œç¨‹</h2>
        </header>
        <div id="order-list" class="p-4 space-y-4">
            <div class="bg-white p-4 rounded-xl border flex justify-between items-center shadow-sm">
                <div>
                    <p class="font-bold text-gray-800">å°šæœªæœ‰ä»»ä½•é ç´„</p>
                    <p class="text-xs text-gray-400">å¿«å»æ¢ç´¢é™„è¿‘çš„ç¾åº—å§ï¼</p>
                </div>
                <button onclick="navigateTo('page-home')" class="text-rose-500 text-sm font-bold">å»é€›é€›</button>
            </div>
        </div>
    </div>

    <div id="page-profile" class="page">
        <header class="bg-rose-500 p-8 text-white rounded-b-[40px] shadow-lg">
            <div class="flex items-center gap-4 mb-6">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center border-2 border-white/50">
                    <i data-lucide="user" class="w-8 h-8 text-white"></i>
                </div>
                <div>
                    <h2 id="profile-phone" class="font-bold text-xl">è«‹å…ˆç™»å…¥</h2>
                    <p class="text-xs opacity-80">ä¸€èˆ¬æœƒå“¡ (Silver)</p>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 flex justify-between items-center">
                <div>
                    <p class="text-[10px] uppercase opacity-70">å„²å€¼é‡‘é¤˜é¡</p>
                    <p id="balance-amount" class="text-2xl font-black tracking-wider">$ 0</p>
                </div>
                <button onclick="topUp()" class="bg-white text-rose-500 px-4 py-2 rounded-xl text-sm font-bold shadow-md">å„²å€¼</button>
            </div>
        </header>
        
        <nav class="p-6 space-y-2">
            <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100">
                <div class="flex items-center gap-3 text-gray-700">
                    <i data-lucide="credit-card" class="w-5 h-5"></i>
                    <span class="text-sm font-medium">æ¶ˆè²»ç´€éŒ„</span>
                </div>
                <i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i>
            </div>
            <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100">
                <div class="flex items-center gap-3 text-gray-700">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                    <span class="text-sm font-medium">ç³»çµ±è¨­å®š</span>
                </div>
                <i data-lucide="chevron-right" class="w-4 h-4 text-gray-300"></i>
            </div>
            <button onclick="loginWithPhone()" id="auth-btn" class="w-full mt-6 bg-slate-800 text-white py-4 rounded-xl font-bold">æ‰‹æ©Ÿè™Ÿç¢¼è¨»å†Š/ç™»å…¥</button>
        </nav>
    </div>

    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-3 z-50">
        <button onclick="navigateTo('page-home')" class="nav-btn flex flex-col items-center text-rose-500" data-page="page-home">
            <i data-lucide="home" class="w-6 h-6"></i>
            <span class="text-[10px] mt-1">æ¢ç´¢</span>
        </button>
        <button onclick="navigateTo('page-orders')" class="nav-btn flex flex-col items-center text-gray-400" data-page="page-orders">
            <i data-lucide="calendar" class="w-6 h-6"></i>
            <span class="text-[10px] mt-1">è¡Œç¨‹</span>
        </button>
        <button onclick="navigateTo('page-profile')" class="nav-btn flex flex-col items-center text-gray-400" data-page="page-profile">
            <i data-lucide="user" class="w-6 h-6"></i>
            <span class="text-[10px] mt-1">æˆ‘çš„</span>
        </button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
            authDomain: "holyhairsalon-f73bf.firebaseapp.com",
            databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
            projectId: "holyhairsalon-f73bf",
            storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
            messagingSenderId: "960169055224",
            appId: "1:960169055224:web:2c826e76e3a177fcbf3c0d",
            measurementId: "G-ZRY4YH5Q63"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        lucide.createIcons();

        // é é¢åˆ‡æ›é‚è¼¯
        window.navigateTo = (pageId, shopName = "åº—å®¶è©³æƒ…") => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // åº•éƒ¨å°èˆªç‹€æ…‹æ›´æ–°
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('text-rose-500', btn.dataset.page === pageId);
                btn.classList.toggle('text-gray-400', btn.dataset.page !== pageId);
            });
            
            if(shopName) document.getElementById('current-shop-name').innerText = shopName;
            window.scrollTo(0,0);
        };

        // åœ°åœ–æœå°‹æç¤º
        window.toggleMap = () => alert("åœ°åœ–æœå°‹åŠŸèƒ½å·²ä¸²æ¥ Firebase GeoPointï¼Œæ­£åœ¨åˆå§‹åŒ–åœ°åœ–åœ–å±¤...");

        // æ‰‹æ©Ÿç™»å…¥èˆ‡å„²å€¼é‡‘åˆå§‹åŒ–
        window.loginWithPhone = () => {
            const phone = prompt("è«‹è¼¸å…¥æ‚¨çš„æ‰‹æ©Ÿè™Ÿç¢¼ (ä¾‹å¦‚: +886912345678)");
            if(phone) alert("ç°¡è¨Šé©—è­‰ç¢¼å·²ç™¼é€è‡³ " + phone + " (Firebase Auth æ¨¡å¼)");
            // å¯¦éš›æµç¨‹ï¼šsignInWithPhoneNumber -> è¼¸å…¥ OTP -> æˆåŠŸ
        };

        // åµæ¸¬ç™»å…¥ä¸¦è®€å–å„²å€¼é‡‘
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('profile-phone').innerText = user.phoneNumber;
                document.getElementById('auth-btn').innerText = "ç™»å‡ºå¸³è™Ÿ";
                
                // å¾ Firestore è®€å–å„²å€¼é‡‘
                const userRef = doc(db, "users", user.uid);
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) {
                    document.getElementById('balance-amount').innerText = `$ ${userSnap.data().balance || 0}`;
                } else {
                    // åˆå§‹åŒ–æ–°ç”¨æˆ¶å„²å€¼é‡‘
                    await setDoc(userRef, { balance: 0, phone: user.phoneNumber });
                }
            }
        });

        // æ¨¡æ“¬å„²å€¼åŠŸèƒ½
        window.topUp = async () => {
            const amount = prompt("è«‹è¼¸å…¥å„²å€¼é‡‘é¡ (æ¨¡æ“¬æ”¯ä»˜)");
            if (amount && auth.currentUser) {
                alert("æ”¯ä»˜æˆåŠŸï¼å„²å€¼é‡‘å·²å…¥å¸³ã€‚");
                // å¯¦éš›æ“ä½œï¼šæ›´æ–° Firestore balance æ¬„ä½
                document.getElementById('balance-amount').innerText = `$ ${amount}`;
            }
        };

        // æ¨¡æ“¬åº—å®¶åˆ—è¡¨
        const mockShops = [
            { id: '1', name: "Holy Hair Salon", cat: "ç¾é«®", rating: 5.0, dist: "0.5km", img: "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=400" },
            { id: '2', name: "éœè¬ SPA æœƒé¤¨", cat: "SPA", rating: 4.8, dist: "2.1km", img: "https://images.unsplash.com/photo-1544161515-4ae6ce6e6529?w=400" }
        ];

        document.getElementById('shop-list').innerHTML = mockShops.map(shop => `
            <div onclick="navigateTo('page-detail', '${shop.name}')" class="bg-white rounded-2xl overflow-hidden shadow-sm border p-3 flex gap-4 cursor-pointer active:scale-95 transition">
                <img src="${shop.img}" class="w-24 h-24 object-cover rounded-xl">
                <div class="flex-1">
                    <div class="flex justify-between items-start">
                        <h3 class="font-bold text-gray-800">${shop.name}</h3>
                        <span class="text-rose-500 font-bold text-xs">â˜… ${shop.rating}</span>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">${shop.cat} Â· è·é›¢ ${shop.dist}</p>
                    <div class="mt-3 flex gap-2">
                        <span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded">å¯å„²å€¼</span>
                        <span class="text-[10px] bg-gray-50 text-gray-500 px-2 py-0.5 rounded">å¿«é€Ÿé ç´„</span>
                    </div>
                </div>
            </div>
        `).join('');

    </script>
</body>
</html>
