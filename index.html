<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美業入口平台 | 您的美感生活地圖</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        #map { width: 100%; height: 300px; border-radius: 20px; margin-top: 10px; }
    </style>
</head>
<body class="bg-gray-50 pb-20">

    <div id="page-home" class="page active">
        <header class="bg-white p-4 sticky top-0 z-50 shadow-sm">
            <div class="flex justify-between items-center mb-3">
                <div class="flex items-center text-rose-500 cursor-pointer" onclick="toggleMapView()">
                    <i data-lucide="map" class="w-5 h-5 mr-1"></i>
                    <span id="map-btn-text" class="font-bold text-sm">開啟地圖搜尋</span>
                </div>
                <h1 class="text-sm font-black text-gray-800 tracking-tighter">美業入口平台</h1>
            </div>
            <div class="relative">
                <input type="text" placeholder="搜尋：美髮、美甲、SPA..." class="w-full bg-gray-100 rounded-full py-2 px-10 focus:outline-none focus:ring-2 focus:ring-rose-300">
                <i data-lucide="search" class="absolute left-3 top-2.5 w-5 h-5 text-gray-400"></i>
            </div>
        </header>

        <section id="map-container" class="px-4 hidden">
            <div class="relative">
                <div id="map"></div>
                <div class="absolute top-5 left-2 flex gap-2">
                    <button onclick="changeMapType('roadmap')" class="bg-white px-3 py-1 rounded-lg shadow text-xs font-bold">街道</button>
                    <button onclick="changeMapType('satellite')" class="bg-white px-3 py-1 rounded-lg shadow text-xs font-bold">衛星</button>
                </div>
            </div>
        </section>

        <section class="p-4 flex gap-6 overflow-x-auto no-scrollbar bg-white shadow-inner">
            <div class="flex flex-col items-center min-w-[60px]"><div class="w-12 h-12 bg-rose-100 rounded-2xl flex items-center justify-center text-rose-500 mb-1"><i data-lucide="scissors"></i></div><span class="text-xs">美髮</span></div>
            <div class="flex flex-col items-center min-w-[60px]"><div class="w-12 h-12 bg-purple-100 rounded-2xl flex items-center justify-center text-purple-500 mb-1"><i data-lucide="sparkles"></i></div><span class="text-xs">美甲</span></div>
            <div class="flex flex-col items-center min-w-[60px]"><div class="w-12 h-12 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-500 mb-1"><i data-lucide="waves"></i></div><span class="text-xs">SPA</span></div>
            <div class="flex flex-col items-center min-w-[60px]"><div class="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center text-green-500 mb-1"><i data-lucide="heart-pulse"></i></div><span class="text-xs">醫美</span></div>
        </section>

        <main class="p-4 space-y-4" id="shop-list">
            </main>
    </div>

    <div id="page-orders" class="page">
        <header class="bg-white p-4 border-b"><h2 class="font-bold text-lg text-center">我的行程</h2></header>
        <div class="p-6 text-center space-y-4">
            <div class="bg-gray-100 rounded-3xl p-10 flex flex-col items-center">
                <i data-lucide="calendar-x" class="w-12 h-12 text-gray-300 mb-3"></i>
                <p class="text-gray-400">目前沒有預約中的行程</p>
            </div>
            <button onclick="navigateTo('page-home')" class="text-rose-500 font-bold">去探索新店家</button>
        </div>
    </div>

    <div id="page-profile" class="page">
        <div class="bg-rose-500 p-8 text-white rounded-b-[40px]">
            <div class="flex items-center gap-4 mb-6">
                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center border-2 border-white/50"><i data-lucide="user" class="w-8 h-8"></i></div>
                <div>
                    <h2 id="display-phone" class="font-bold text-xl">訪客身份</h2>
                    <p class="text-xs opacity-70">尚未登入</p>
                </div>
            </div>
            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 flex justify-between items-center">
                <div><p class="text-[10px] opacity-70 uppercase">儲值金餘額</p><p id="display-balance" class="text-2xl font-black">$ 0</p></div>
                <button onclick="simulateTopUp()" class="bg-white text-rose-500 px-4 py-2 rounded-xl text-sm font-bold shadow-md">儲值</button>
            </div>
        </div>
        <div class="p-6">
            <button onclick="phoneLogin()" id="login-btn" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold shadow-lg">手機號碼登入 / 註冊</button>
            <div class="mt-6 space-y-3">
                <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100"><span class="text-sm font-medium">常見問題</span><i data-lucide="chevron-right" class="w-4 h-4"></i></div>
                <div class="flex items-center justify-between p-4 bg-white rounded-xl border border-gray-100"><span class="text-sm font-medium">聯繫平台客服</span><i data-lucide="chevron-right" class="w-4 h-4"></i></div>
            </div>
        </div>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-3 z-50">
        <button onclick="navigateTo('page-home')" class="nav-item text-rose-500" data-target="page-home"><i data-lucide="home" class="w-6 h-6"></i><span class="text-[10px] block">探索</span></button>
        <button onclick="navigateTo('page-orders')" class="nav-item text-gray-400" data-target="page-orders"><i data-lucide="calendar" class="w-6 h-6"></i><span class="text-[10px] block">行程</span></button>
        <button onclick="navigateTo('page-profile')" class="nav-item text-gray-400" data-target="page-profile"><i data-lucide="user" class="w-6 h-6"></i><span class="text-[10px] block">我的</span></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        // 您的金鑰配置
        const firebaseConfig = {
            apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
            authDomain: "holyhairsalon-f73bf.firebaseapp.com",
            databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
            projectId: "holyhairsalon-f73bf",
            storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
            messagingSenderId: "960169055224",
            appId: "1:960169055224:web:2c826e76e3a177fcbf3c0d",
            measurementId: "G-ZRY4YH5Q63"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);

        lucide.createIcons();

        // 頁面切換邏輯
        window.navigateTo = (id) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => {
                n.classList.toggle('text-rose-500', n.dataset.target === id);
                n.classList.toggle('text-gray-400', n.dataset.target !== id);
            });
            window.scrollTo(0,0);
        };

        // 地圖切換邏輯
        let map;
        window.toggleMapView = () => {
            const container = document.getElementById('map-container');
            const btnText = document.getElementById('map-btn-text');
            const isHidden = container.classList.toggle('hidden');
            btnText.innerText = isHidden ? "開啟地圖搜尋" : "關閉地圖視圖";
            if(!isHidden && !map) initMap();
        };

        function initMap() {
            const taipei = { lat: 25.0339, lng: 121.5644 };
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 15,
                center: taipei,
                disableDefaultUI: true
            });
            new google.maps.Marker({ position: taipei, map, title: "附近美髮店" });
        }

        window.changeMapType = (type) => map.setMapTypeId(type);

        // 儲值與用戶邏輯
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('display-phone').innerText = user.phoneNumber;
                document.getElementById('login-btn').innerText = "登出帳號";
                const userRef = doc(db, "users", user.uid);
                const snap = await getDoc(userRef);
                if (snap.exists()) document.getElementById('display-balance').innerText = `$ ${snap.data().balance || 0}`;
                else await setDoc(userRef, { balance: 0, phone: user.phoneNumber });
            }
        });

        window.simulateTopUp = () => {
            const amount = prompt("請輸入儲值金額 (Demo)");
            if(amount) alert(`已成功儲值 $${amount}，金額已連動至資料庫。`);
        };

        window.phoneLogin = () => {
            const phone = prompt("請輸入手機號碼 (+886)");
            if(phone) alert("簡訊驗證碼功能已透過 Firebase Auth 備就。");
        };

        // 初始渲染店家
        const shops = [{name: "Holy Hair Salon", cat: "美髮"}, {name: "靜謐 SPA", cat: "SPA"}];
        document.getElementById('shop-list').innerHTML = shops.map(s => `
            <div class="bg-white p-4 rounded-2xl border flex justify-between items-center shadow-sm">
                <div><h3 class="font-bold text-gray-800">${s.name}</h3><p class="text-xs text-gray-400">${s.cat} · 距離 0.8km</p></div>
                <button class="bg-rose-500 text-white text-xs px-4 py-2 rounded-lg font-bold">預約</button>
            </div>
        `).join('');
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
</body>
</html>
