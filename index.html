<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美業入口平台 | 三層式預約導流系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        #map { width: 100%; height: 250px; border-radius: 20px; }
    </style>
</head>
<body class="bg-gray-50 pb-20">

    <div id="page-home" class="page active">
        <header class="bg-white p-4 sticky top-0 z-50 shadow-sm flex justify-between items-center">
            <div class="flex items-center text-rose-500 cursor-pointer" onclick="toggleMapView()">
                <i data-lucide="map" class="w-5 h-5 mr-1"></i>
                <span class="font-bold text-sm">地圖探索</span>
            </div>
            <h1 class="text-sm font-black text-gray-800">美業入口平台</h1>
            <i data-lucide="search" class="w-5 h-5 text-gray-400"></i>
        </header>
        <section id="map-container" class="px-4 hidden py-2"><div id="map"></div></section>
        <main class="p-4 space-y-4" id="shop-list-container">
            </main>
    </div>

    <div id="page-shop-detail" class="page bg-white min-h-screen">
        <nav class="p-4 flex items-center border-b sticky top-0 bg-white z-50">
            <button onclick="navigateTo('page-home')"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
            <span id="detail-title" class="ml-4 font-bold text-lg">店家介紹</span>
        </nav>
        <div class="p-6 space-y-6">
            <div class="h-48 bg-slate-200 rounded-3xl overflow-hidden shadow-inner">
                <img id="detail-img" src="https://images.unsplash.com/photo-1560066984-138dadb4c035?w=600" class="w-full h-full object-cover">
            </div>
            <div>
                <h2 id="detail-name" class="text-2xl font-black text-slate-800">店家名稱</h2>
                <div class="flex gap-2 mt-2">
                    <span class="text-[10px] bg-rose-50 text-rose-500 px-2 py-0.5 rounded font-bold">優質認證</span>
                    <span class="text-[10px] bg-gray-50 text-gray-500 px-2 py-0.5 rounded font-bold">提供儲值金優惠</span>
                </div>
            </div>
            <p id="detail-desc" class="text-gray-500 leading-relaxed text-sm">
                這裡顯示的是店家自己經營的簡介與特色內容...
            </p>
            <div class="pt-6">
                <h3 class="font-bold mb-4 flex items-center"><i data-lucide="star" class="w-4 h-4 mr-2 text-yellow-400"></i> 服務清單</h3>
                <div class="space-y-3" id="service-list">
                    </div>
            </div>
        </div>
        <div class="fixed bottom-0 p-4 bg-white border-t w-full">
            <button onclick="navigateTo('page-booking')" class="w-full bg-rose-500 text-white py-4 rounded-2xl font-bold shadow-lg shadow-rose-100">立即預約服務</button>
        </div>
    </div>

    <div id="page-booking" class="page bg-slate-50 min-h-screen">
        <nav class="p-4 flex items-center border-b bg-white">
            <button onclick="navigateTo('page-shop-detail')"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
            <span class="ml-4 font-bold">選擇時段</span>
        </nav>
        <div class="p-6">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-100 mb-6">
                <label class="block text-xs font-bold text-gray-400 mb-2 uppercase">選擇日期</label>
                <input type="date" class="w-full text-lg font-bold outline-none">
            </div>
            <div class="grid grid-cols-3 gap-3">
                <button class="bg-white py-4 rounded-xl text-sm font-bold border hover:border-rose-500 hover:text-rose-500 transition">10:00</button>
                <button class="bg-white py-4 rounded-xl text-sm font-bold border hover:border-rose-500 hover:text-rose-500 transition">14:00</button>
                <button class="bg-white py-4 rounded-xl text-sm font-bold border hover:border-rose-500 hover:text-rose-500 transition">16:30</button>
            </div>
            <button onclick="submitBooking()" class="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold mt-10 shadow-xl">確認並完成預約</button>
        </div>
    </div>

    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-3 z-50">
        <button onclick="navigateTo('page-home')" class="nav-item text-rose-500" data-target="page-home"><i data-lucide="home" class="w-6 h-6"></i><span class="text-[10px] block">探索</span></button>
        <button onclick="navigateTo('page-orders')" class="nav-item text-gray-400" data-target="page-orders"><i data-lucide="calendar" class="w-6 h-6"></i><span class="text-[10px] block">行程</span></button>
        <button onclick="navigateTo('page-profile')" class="nav-item text-gray-400" data-target="page-profile"><i data-lucide="user" class="w-6 h-6"></i><span class="text-[10px] block">我的</span></button>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCOhBN9TH3UJSOSx5XVyQ08f_2RUckvXYU",
            authDomain: "holyhairsalon-f73bf.firebaseapp.com",
            databaseURL: "https://holyhairsalon-f73bf-default-rtdb.firebaseio.com",
            projectId: "holyhairsalon-f73bf",
            storageBucket: "holyhairsalon-f73bf.firebasestorage.app",
            messagingSenderId: "960169055224",
            appId: "1:960169055224:web:2c826e76e3a177fcbf3c0d",
            measurementId: "G-ZRY4YH5Q63"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        lucide.createIcons();

        // 頁面跳轉與隱藏導覽列邏輯
        window.navigateTo = (id, data = null) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            // 只有首頁、行程、個人中心顯示底部導覽
            const mainTabs = ['page-home', 'page-orders', 'page-profile'];
            document.getElementById('bottom-nav').style.display = mainTabs.includes(id) ? 'flex' : 'none';

            if(id === 'page-shop-detail' && data) {
                document.getElementById('detail-name').innerText = data.name;
                document.getElementById('detail-desc').innerText = data.desc;
            }
            window.scrollTo(0,0);
        };

        // 店家資料 (分權核心)
        const shops = {
            "001": { name: "A店 · 時尚髮藝", desc: "台北頂級美髮沙龍，擁有專業設計師團隊...", services: ["洗剪專案 $800", "專業染髮 $2500"] },
            "002": { name: "B店 · 精緻美甲", desc: "日式光療專業服務，讓您的雙手煥然一新...", services: ["單色光療 $900", "法式美甲 $1200"] },
            "003": { name: "C店 · 舒活SPA", desc: "城市中的心靈綠洲，深層放鬆精油按摩...", services: ["全身按摩 $1800", "足底舒壓 $800"] }
        };

        // 渲染首頁列表 (第一層)
        document.getElementById('shop-list-container').innerHTML = Object.entries(shops).map(([code, info]) => `
            <div onclick="navigateTo('page-shop-detail', {name:'${info.name}', desc:'${info.desc}'})" class="bg-white p-4 rounded-3xl flex justify-between items-center shadow-sm border border-transparent hover:border-rose-200 transition">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center font-bold text-slate-300">LOGO</div>
                    <div><h3 class="font-bold text-slate-800">${info.name}</h3><p class="text-[10px] text-gray-400">點擊查看環境與服務內容</p></div>
                </div>
                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-300"></i>
            </div>
        `).join('');

        // 地圖切換
        let map;
        window.toggleMapView = () => {
            const container = document.getElementById('map-container');
            if(container.classList.toggle('hidden')) return;
            if(!map) map = new google.maps.Map(document.getElementById("map"), { zoom: 15, center: {lat: 25.0339, lng: 121.5644}, disableDefaultUI: true });
        };
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
</body>
</html>
